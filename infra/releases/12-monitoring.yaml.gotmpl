repositories:
  - name: prometheus-community
    url: https://prometheus-community.github.io/helm-charts

releases:
  - name: prometheus
    chart: prometheus-community/kube-prometheus-stack
    namespace: {{ .Values.prometheus.namespace | default "monitoring" }}
    version: 62.7.0
    installed: {{ .Values.prometheus.enabled | default false }}
    values:
      - {{ toYaml .Values | nindent 8 }}
    hooks:
      - events: ["presync"]
        showlogs: true
        command: "../scripts/create-prometheus-certs.sh"
        args:
          - prometheus # Name of the Prometheus release
          - {{ .Values.prometheus.namespace | default "monitoring" }}
          - {{ .Values.prometheus.tlsSecretName | default "prometheus-tls" }}
    labels:
      type: monitoring
      kind: prometheus
